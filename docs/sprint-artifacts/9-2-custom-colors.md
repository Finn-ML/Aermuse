# Story 9.2: Custom Colors

## Story Overview

| Field | Value |
|-------|-------|
| **Story ID** | 9.2 |
| **Epic** | Epic 9: Landing Page Customization |
| **Title** | Custom Colors |
| **Priority** | P0 - High (Phase 1 MVP) |
| **Story Points** | 2 |
| **Status** | Drafted |

## User Story

**As an** artist
**I want** to customize my page colors beyond preset themes
**So that** my page matches my exact brand colors

## Context

Building on Story 9.1 (Theme Presets), this story adds granular color customization. Users can override theme colors or create fully custom color schemes.

**Dependencies:**
- Story 9.1 (Theme Presets) - schema fields already created

## Acceptance Criteria

- [ ] **AC-1:** Color picker available for primary, secondary, accent, and text colors
- [ ] **AC-2:** Hex code input accepts valid hex values (#RGB or #RRGGBB)
- [ ] **AC-3:** Preview updates immediately on color change
- [ ] **AC-4:** Warning shown if text/background contrast ratio < 4.5:1 (WCAG AA)
- [ ] **AC-5:** Colors persist after save and reload
- [ ] **AC-6:** Selecting custom colors clears themeId (marks as "custom")

## Technical Requirements

### New Dependency

```bash
npm install react-colorful
```

### Files to Create

| File | Purpose |
|------|---------|
| `client/src/components/landing/ColorPicker.tsx` | Reusable color picker with hex input |

### Files to Modify

| File | Changes |
|------|---------|
| `client/src/pages/Dashboard.tsx` | Add color customization section to landing editor |
| `client/src/pages/ArtistPage.tsx` | Apply textColor (if not already from 9.1) |

### Color Contrast Validation

```typescript
// Utility function for WCAG contrast ratio
function getContrastRatio(color1: string, color2: string): number {
  const lum1 = getLuminance(color1);
  const lum2 = getLuminance(color2);
  const brightest = Math.max(lum1, lum2);
  const darkest = Math.min(lum1, lum2);
  return (brightest + 0.05) / (darkest + 0.05);
}

function getLuminance(hex: string): number {
  const rgb = hexToRgb(hex);
  const [r, g, b] = rgb.map(c => {
    c = c / 255;
    return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
  });
  return 0.2126 * r + 0.7152 * g + 0.0722 * b;
}
```

## Definition of Done

- [ ] react-colorful installed
- [ ] ColorPicker component created with hex input
- [ ] All 4 color fields editable in Dashboard
- [ ] Contrast warning displays when ratio < 4.5:1
- [ ] Colors save and persist
- [ ] Type check passes

---

## Tasks/Subtasks

- [ ] **Task 1: Install react-colorful**
  - [ ] Run `npm install react-colorful`
  - [ ] Verify package added to package.json

- [ ] **Task 2: Create ColorPicker Component**
  - [ ] Create `client/src/components/landing/ColorPicker.tsx`
  - [ ] Integrate HexColorPicker from react-colorful
  - [ ] Add hex input field with validation
  - [ ] Support label and onChange props
  - [ ] Show color preview swatch

- [ ] **Task 3: Add Contrast Validation Utility**
  - [ ] Create contrast ratio calculation function
  - [ ] Create getLuminance helper
  - [ ] Create hexToRgb helper
  - [ ] Export from shared utility file

- [ ] **Task 4: Integrate Color Pickers in Dashboard**
  - [ ] Add "Colors" section to landing page editor
  - [ ] Add ColorPicker for primaryColor
  - [ ] Add ColorPicker for secondaryColor
  - [ ] Add ColorPicker for accentColor
  - [ ] Add ColorPicker for textColor
  - [ ] Show contrast warning when text vs background < 4.5:1
  - [ ] Clear themeId when colors manually changed

- [ ] **Task 5: Testing**
  - [ ] Verify color picker opens and selects colors
  - [ ] Verify hex input accepts valid values
  - [ ] Verify contrast warning appears appropriately
  - [ ] Verify colors persist after save

---

## Dev Notes

### Learnings from Previous Story

**From Story 9-1-theme-presets:**
- Schema fields for colors already added (primaryColor, secondaryColor, accentColor, textColor)
- updateLandingPageMutation already handles partial updates
- ArtistPage already applies primaryColor and secondaryColor

### References
- [Source: docs/sprint-artifacts/tech-spec-epic-9.md#Story-9.2-Custom-Colors]

---

## Dev Agent Record

### Context Reference
<!-- Will be generated by story-context workflow -->

### Agent Model Used

### Debug Log References

### Completion Notes List

### File List

---

## Change Log

| Date | Change | Author |
|------|--------|--------|
| 2025-12-01 | Story drafted | SM Agent (Bob) |
